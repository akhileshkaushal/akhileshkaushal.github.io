


<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="./">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Differential Methylation and Advanced Analysis &mdash; Methylation Analysis Pipeline 1.0.0 documentation</title>
      <link rel="stylesheet" type="text/css" href="_static/pygments.css?v=b86133f3" />
      <link rel="stylesheet" type="text/css" href="_static/css/theme.css?v=e59714d7" />
      <link rel="stylesheet" type="text/css" href="_static/copybutton.css?v=76b2166b" />
      <link rel="stylesheet" type="text/css" href="_static/css/custom.css?v=9482ece9" />

  
    <link rel="canonical" href="https://akhileshkaushal.github.io/methylation/dma.html" />
      <script src="_static/jquery.js?v=5d32c60e"></script>
      <script src="_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
      <script src="_static/documentation_options.js?v=4ebf8126"></script>
      <script src="_static/doctools.js?v=9bcbadda"></script>
      <script src="_static/sphinx_highlight.js?v=dc90522c"></script>
      <script src="_static/clipboard.min.js?v=a7894cd8"></script>
      <script src="_static/copybutton.js?v=f281be69"></script>
    <script src="_static/js/theme.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="run_pipeline.R Script" href="runpipeline.html" />
    <link rel="prev" title="Preprocessing and Quality Control" href="qc.html" />
   
  <link rel="icon" href="_static/images/favicon.ico">

</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="index.html" class="icon icon-home">
            Methylation Analysis Pipeline
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="Intro.html">Introduction and Overview</a><ul>
<li class="toctree-l2"><a class="reference internal" href="Intro.html#dna-methylation-profiling-using-illumina-epic-arrays">DNA Methylation Profiling Using Illumina EPIC Arrays</a></li>
<li class="toctree-l2"><a class="reference internal" href="Intro.html#why-use-epic-arrays">Why Use EPIC Arrays?</a></li>
<li class="toctree-l2"><a class="reference internal" href="Intro.html#biological-applications">Biological Applications</a></li>
<li class="toctree-l2"><a class="reference internal" href="Intro.html#overview-of-the-analysis-workflow">Overview of the Analysis Workflow</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="install.html">Installation and Setup</a><ul>
<li class="toctree-l2"><a class="reference internal" href="install.html#prerequisites">Prerequisites</a></li>
<li class="toctree-l2"><a class="reference internal" href="install.html#directory-structure">Directory Structure</a></li>
<li class="toctree-l2"><a class="reference internal" href="install.html#configuration-file">Configuration File</a></li>
<li class="toctree-l2"><a class="reference internal" href="install.html#execution">Execution</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="qc.html">Preprocessing and Quality Control</a><ul>
<li class="toctree-l2"><a class="reference internal" href="qc.html#idat-import-and-sample-sheet-configuration">1. IDAT Import and Sample Sheet Configuration</a></li>
<li class="toctree-l2"><a class="reference internal" href="qc.html#quality-control">2. Quality Control</a></li>
<li class="toctree-l2"><a class="reference internal" href="qc.html#probe-filtering">3. Probe Filtering</a></li>
<li class="toctree-l2"><a class="reference internal" href="qc.html#normalization">4. Normalization</a></li>
<li class="toctree-l2"><a class="reference internal" href="qc.html#beta-and-m-value-extraction">5. Beta and M-value Extraction</a></li>
</ul>
</li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Differential Methylation and Advanced Analysis</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#differentially-methylated-positions-dmps">1. Differentially Methylated Positions (DMPs)</a></li>
<li class="toctree-l2"><a class="reference internal" href="#differentially-methylated-regions-dmrs">2. Differentially Methylated Regions (DMRs)</a></li>
<li class="toctree-l2"><a class="reference internal" href="#batch-effect-correction">3. Batch Effect Correction</a></li>
<li class="toctree-l2"><a class="reference internal" href="#annotation-and-genomic-context">4. Annotation and Genomic Context</a></li>
<li class="toctree-l2"><a class="reference internal" href="#visualization">5. Visualization</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="runpipeline.html">run_pipeline.R Script</a></li>
<li class="toctree-l1"><a class="reference internal" href="structure.html">Pipeline Structure and Containerization</a><ul>
<li class="toctree-l2"><a class="reference internal" href="structure.html#directory-layout">Directory Layout</a></li>
<li class="toctree-l2"><a class="reference internal" href="structure.html#containerization-options">Containerization Options</a></li>
<li class="toctree-l2"><a class="reference internal" href="structure.html#best-practices">Best Practices</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="casestudy.html">Case Study: DNA Methylation Signatures in Allergy</a><ul>
<li class="toctree-l2"><a class="reference internal" href="casestudy.html#study-design">Study Design</a></li>
<li class="toctree-l2"><a class="reference internal" href="casestudy.html#pipeline-execution">Pipeline Execution</a></li>
<li class="toctree-l2"><a class="reference internal" href="casestudy.html#key-findings">Key Findings</a><ul>
<li class="toctree-l3"><a class="reference internal" href="casestudy.html#differentially-methylated-positions-dmps">1. Differentially Methylated Positions (DMPs)</a></li>
<li class="toctree-l3"><a class="reference internal" href="casestudy.html#differentially-methylated-regions-dmrs">2. Differentially Methylated Regions (DMRs)</a></li>
<li class="toctree-l3"><a class="reference internal" href="casestudy.html#genomic-annotation-and-regulatory-context">3. Genomic Annotation and Regulatory Context</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="casestudy.html#integration-with-external-datasets">Integration with External Datasets</a></li>
<li class="toctree-l2"><a class="reference internal" href="casestudy.html#pathway-enrichment">Pathway Enrichment</a></li>
<li class="toctree-l2"><a class="reference internal" href="casestudy.html#visualization-highlights">Visualization Highlights</a></li>
<li class="toctree-l2"><a class="reference internal" href="casestudy.html#conclusion">Conclusion</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="references.html">References</a><ul>
<li class="toctree-l2"><a class="reference internal" href="references.html#pipeline-methodology">Pipeline Methodology</a></li>
<li class="toctree-l2"><a class="reference internal" href="references.html#annotation-and-genomic-context">Annotation and Genomic Context</a></li>
<li class="toctree-l2"><a class="reference internal" href="references.html#pathway-enrichment-and-visualization">Pathway Enrichment and Visualization</a></li>
<li class="toctree-l2"><a class="reference internal" href="references.html#allergy-case-study">Allergy Case Study</a></li>
</ul>
</li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">Methylation Analysis Pipeline</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content style-external-links">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="index.html" class="icon icon-home" aria-label="Home"></a></li>
      <li class="breadcrumb-item active">Differential Methylation and Advanced Analysis</li>
      <li class="wy-breadcrumbs-aside">
            <a href="_sources/dma.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul><div class="rst-breadcrumbs-buttons" role="navigation" aria-label="Sequential page navigation">
        <a href="qc.html" class="btn btn-neutral float-left" title="Preprocessing and Quality Control" accesskey="p"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="runpipeline.html" class="btn btn-neutral float-right" title="run_pipeline.R Script" accesskey="n">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
  </div>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="differential-methylation-and-advanced-analysis">
<h1>Differential Methylation and Advanced Analysis<a class="headerlink" href="#differential-methylation-and-advanced-analysis" title="Link to this heading"></a></h1>
<p>This section describes the comprehensive steps used to identify differentially methylated CpG sites (DMPs), differentially methylated regions (DMRs), correct for batch effects, annotate genomic context, and visualize key methylation patterns. Robust modeling, careful annotation, and integrative visualizations are essential for biologically meaningful results.</p>
<section id="differentially-methylated-positions-dmps">
<h2>1. Differentially Methylated Positions (DMPs)<a class="headerlink" href="#differentially-methylated-positions-dmps" title="Link to this heading"></a></h2>
<p>To identify DMPs, methylation M-values are modeled using <code class="docutils literal notranslate"><span class="pre">limma</span></code>, a linear modeling framework suited for microarray data. The analysis adjusts for confounding variables such as sex, age, batch, and other covariates.</p>
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="n">design</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">model.matrix</span><span class="p">(</span><span class="o">~</span><span class="w"> </span><span class="n">group</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">sex</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">batch</span><span class="p">,</span><span class="w"> </span><span class="n">data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">targets</span><span class="p">)</span>
<span class="n">fit</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">lmFit</span><span class="p">(</span><span class="n">mVals</span><span class="p">,</span><span class="w"> </span><span class="n">design</span><span class="p">)</span>
<span class="n">fit</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">eBayes</span><span class="p">(</span><span class="n">fit</span><span class="p">)</span>
<span class="n">dmp_table</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">topTable</span><span class="p">(</span><span class="n">fit</span><span class="p">,</span><span class="w"> </span><span class="n">coef</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;groupCase&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">number</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">Inf</span><span class="p">,</span><span class="w"> </span><span class="n">adjust</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;BH&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>The resulting table includes:</p>
<ul class="simple">
<li><p>Log2 fold changes (logFC)</p></li>
<li><p>Adjusted p-values (FDR)</p></li>
<li><p>Average methylation levels per group</p></li>
<li><p>B-statistics (log-odds of differential methylation)</p></li>
</ul>
</section>
<section id="differentially-methylated-regions-dmrs">
<h2>2. Differentially Methylated Regions (DMRs)<a class="headerlink" href="#differentially-methylated-regions-dmrs" title="Link to this heading"></a></h2>
<p>While individual CpGs offer resolution, aggregating them into regions provides biologically cohesive insights. Several tools are available:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">DMRcate</span></code> (recommended for Illumina data)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">Bumphunter</span></code> (included in minfi)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">DMRfinder</span></code></p></li>
</ul>
<p>Example with <code class="docutils literal notranslate"><span class="pre">DMRcate</span></code>:</p>
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="n">myAnnotation</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">cpg.annotate</span><span class="p">(</span>
<span class="w">  </span><span class="n">object</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">mVals</span><span class="p">,</span>
<span class="w">  </span><span class="n">datatype</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;array&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="n">what</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;M&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="n">analysis.type</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;differential&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="n">design</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">design</span><span class="p">,</span>
<span class="w">  </span><span class="n">coef</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;groupCase&quot;</span><span class="p">,</span>
<span class="w">  </span><span class="n">arraytype</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;EPIC&quot;</span>
<span class="p">)</span>

<span class="n">dmrcoutput</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">dmrcate</span><span class="p">(</span><span class="n">myAnnotation</span><span class="p">,</span><span class="w"> </span><span class="n">lambda</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">1000</span><span class="p">,</span><span class="w"> </span><span class="n">C</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">2</span><span class="p">)</span>
<span class="n">dmr_ranges</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">extractRanges</span><span class="p">(</span><span class="n">dmrcoutput</span><span class="p">,</span><span class="w"> </span><span class="n">genome</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;hg38&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>Output includes genomic coordinates, mean delta beta, number of probes, and FDR-adjusted p-values.</p>
</section>
<section id="batch-effect-correction">
<h2>3. Batch Effect Correction<a class="headerlink" href="#batch-effect-correction" title="Link to this heading"></a></h2>
<p>Batch effects (e.g., slide, processing date) are common in large datasets. To correct for unwanted technical variation:</p>
<ul class="simple">
<li><p>Include batch variables in the <code class="docutils literal notranslate"><span class="pre">limma</span></code> model.</p></li>
<li><p>Optionally apply <code class="docutils literal notranslate"><span class="pre">limma::removeBatchEffect()</span></code> on M-values before visualization.</p></li>
</ul>
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="n">corrected</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">removeBatchEffect</span><span class="p">(</span><span class="n">mVals</span><span class="p">,</span><span class="w"> </span><span class="n">batch</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">targets</span><span class="o">$</span><span class="n">Slide</span><span class="p">,</span><span class="w"> </span><span class="n">covariates</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">targets</span><span class="o">$</span><span class="n">Sex</span><span class="p">)</span>
</pre></div>
</div>
<p>This ensures biological signals (e.g., case vs. control) are not confounded by technical noise.</p>
</section>
<section id="annotation-and-genomic-context">
<h2>4. Annotation and Genomic Context<a class="headerlink" href="#annotation-and-genomic-context" title="Link to this heading"></a></h2>
<p>After identifying DMPs/DMRs, map them to genomic features to interpret their regulatory impact. Use the Illumina annotation package:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">IlluminaHumanMethylationEPICanno.ilm10b4.hg38</span></code></p></li>
<li><p>or <code class="docutils literal notranslate"><span class="pre">annotatr</span></code> for broader feature support</p></li>
</ul>
<p>Common annotation categories:</p>
<ul class="simple">
<li><p>Promoter regions (e.g., TSS200, TSS1500)</p></li>
<li><p>5’UTR, gene body, 3’UTR</p></li>
<li><p>Enhancer and open chromatin (based on ENCODE or ChromHMM)</p></li>
<li><p>Intergenic</p></li>
</ul>
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="n">anno</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">getAnnotation</span><span class="p">(</span><span class="n">IlluminaHumanMethylationEPICanno.ilm10b4.hg38</span><span class="p">)</span>
<span class="n">annotated</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">cbind</span><span class="p">(</span><span class="n">dmp_table</span><span class="p">,</span><span class="w"> </span><span class="n">anno</span><span class="p">[</span><span class="nf">rownames</span><span class="p">(</span><span class="n">dmp_table</span><span class="p">),</span><span class="w"> </span><span class="p">])</span>
</pre></div>
</div>
<p>This step enables downstream pathway and region-based aggregation.</p>
</section>
<section id="visualization">
<h2>5. Visualization<a class="headerlink" href="#visualization" title="Link to this heading"></a></h2>
<p>Effective visualization provides insight into data quality, sample separation, and significant methylation shifts:</p>
<ul class="simple">
<li><p><strong>Volcano plots</strong>: Highlight logFC vs. adjusted p-values for DMPs.</p></li>
<li><p><strong>Heatmaps</strong>: Display top variable or significant CpGs across samples.</p></li>
<li><p><strong>PCA plots</strong>: Show sample clustering and detect outliers.</p></li>
<li><p><strong>TSS methylation metaplot</strong>: Visualize methylation trend ±2kb around TSS.</p></li>
<li><p><strong>ORA / GSEA</strong>: Enrich gene-level DMPs using MSigDB or KEGG.</p></li>
</ul>
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="nf">library</span><span class="p">(</span><span class="n">EnhancedVolcano</span><span class="p">)</span>
<span class="nf">EnhancedVolcano</span><span class="p">(</span><span class="n">dmp_table</span><span class="p">,</span>
<span class="w">                </span><span class="n">lab</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">dmp_table</span><span class="o">$</span><span class="n">gene</span><span class="p">,</span>
<span class="w">                </span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&#39;logFC&#39;</span><span class="p">,</span>
<span class="w">                </span><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&#39;adj.P.Val&#39;</span><span class="p">)</span>

<span class="nf">pheatmap</span><span class="p">(</span><span class="n">betaVals</span><span class="p">[</span><span class="nf">head</span><span class="p">(</span><span class="nf">order</span><span class="p">(</span><span class="nf">rowVars</span><span class="p">(</span><span class="n">betaVals</span><span class="p">),</span><span class="w"> </span><span class="n">decreasing</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">TRUE</span><span class="p">),</span><span class="w"> </span><span class="m">500</span><span class="p">),</span><span class="w"> </span><span class="p">])</span>

<span class="nf">plotPCA</span><span class="p">(</span><span class="n">corrected</span><span class="p">,</span><span class="w"> </span><span class="n">targets</span><span class="o">$</span><span class="n">group</span><span class="p">)</span>
</pre></div>
</div>
<p>All visualization outputs are saved in the <code class="docutils literal notranslate"><span class="pre">output/plots/</span></code> directory for inclusion in reports or manuscripts.</p>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="qc.html" class="btn btn-neutral float-left" title="Preprocessing and Quality Control" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="runpipeline.html" class="btn btn-neutral float-right" title="run_pipeline.R Script" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2025, Akhilesh Kaushal.</p>
  </div>

   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>